<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Live Vitals â€“ Real Browser Audit</title>
  <meta name="description" content="Real Core Web Vitals from your device â€“ no proxy">
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#000">
  <style>
    :root{--bg:#000;--text:#fff;--accent:#00ff9d;--card:#111;--good:#00ff9d;--bad:#ff3b30;--radius:16px}
    @media (prefers-color-scheme:light){:root{--bg:#fff;--text:#000;--card:#f5f5f5;--accent:#0d9488;--good:#0d9488;--bad:#ef4444}}
    body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,sans-serif;min-height:100vh;display:grid;place-items:center;padding:1rem}
    .card{background:var(--card);padding:2rem;border-radius:var(--radius);max-width:500px;width:100%;text-align:center;box-shadow:0 10px 40px rgba(0,255,157,.2)}
    h1{color:var(--accent);margin:0 0 .5rem;font-size:2.4rem}
    .score{font-size:5.5rem;margin:1rem 0;font-weight:900;color:var(--good)}
    button{background:var(--accent);color:#000;padding:1rem 2rem;border:none;border-radius:50px;font-weight:700;cursor:pointer;margin-top:1rem}
    .metrics{display:grid;gap:1rem;margin-top:2rem}
    .metric{background:var(--card);padding:1.2rem;border-radius:var(--radius)}
    .value{font-size:2rem;font-weight:700;color:var(--accent)}
    .status{display:inline-block;padding:0.4rem 1rem;border-radius:50px;font-weight:bold;margin:0.5rem 0}
    .good{background:var(--good);color:#000}.bad{background:var(--bad);color:#fff}
    details{cursor:pointer;margin-top:1rem}
    summary{font-weight:600}
    .spinner{width:50px;height:50px;border:6px solid var(--card);border-top-color:var(--accent);border-radius:50%;animation:s 1s linear infinite;margin:2rem auto}
    @keyframes s{to{transform:rotate(360deg)}}
  </style>
</head>
<body>

<div class="card">
  <h1>Live Vitals</h1>
  <p>Real Core Web Vitals from <strong>your device</strong></p>
  <div id="status">Click below to measure</div>
  <button onclick="runAudit()">Run Live Audit</button>

  <div id="results" style="display:none">
    <div class="score" id="vitality">â€“</div>
    <p id="desc"></p>

    <div class="metrics" id="metrics"></div>
    <button onclick="runAudit()">Run Again</button>
  </div>
</div>

<script>
// Live metrics storage
let lcp, inp, cls, fcp, ttfb, tbt = 0;

new PerformanceObserver((list) => {
  for (const entry of list.getEntries()) {
    if (entry.name === 'first-contentful-paint') fcp = entry.startTime;
    if (entry.entryType === 'largest-contentful-paint') lcp = entry.renderTime || entry.loadTime;
    if (entry.entryType === 'layout-shift' && !entry.hadRecentInput) cls += entry.value;
  }
}).observe({type: 'paint', buffered: true});
new PerformanceObserver((list) => {
  for (const entry of list.getEntries()) {
    if (entry.entryType === 'largest-contentful-paint') lcp = entry.renderTime || entry.loadTime;
  }
}).observe({type: 'largest-contentful-paint', buffered: true});
new PerformanceObserver((list) => {
  for (const entry of list.getEntries()) {
    if (entry.entryType === 'layout-shift' && !entry.hadRecentInput) cls += entry.value;
  }
}).observe({type: 'layout-shift', buffered: true});

// INP approximation via long tasks + event timings
let worstINP = 0;
new PerformanceObserver((list) => {
  for (const entry of list.getEntries()) {
    if (entry.duration > worstINP) worstINP = entry.duration;
    tbt += entry.duration;
  }
}).observe({type: 'longtask', buffered: true});

function runAudit() {
  // Reset
  lcp = fcp = ttfb = 0; cls = 0; worstINP = 0; tbt = 0;
  document.getElementById('results').style.display = 'none';
  document.getElementById('status').innerHTML = '<div class="spinner"></div>Measuring your deviceâ€¦';

  // Measure TTFB from navigation
  const nav = performance.getEntriesByType('navigation')[0];
  ttfb = nav ? nav.responseStart - nav.requestStart : 0;

  setTimeout(() => {
    if (!lcp) lcp = 3000;
    if (!worstINP) worstINP = 100;

    const lcpScore = Math.min(30, (2500 / lcp) * 30);
    const inpScore = Math.min(25, (200 / worstINP) * 25);
    const clsScore = Math.min(20, (0.1 / (cls || 0.01)) * 20);
    const fcpScore = fcp ? Math.min(15, (1800 / fcp) * 15) : 8;
    const ttfbScore = Math.min(10, (600 / (ttfb || 100)) * 10);

    const vitality = Math.round(lcpScore + inpScore + clsScore + fcpScore + ttfbScore);
    const capped = Math.min(100, vitality);

    document.getElementById('vitality').textContent = capped;
    document.getElementById('desc').textContent = capped >= 90 ? 'Excellent ðŸ”¥' : capped >= 70 ? 'Good' : 'Needs Work';
    
    document.getElementById('metrics').innerHTML = `
      <div class="metric"><div class="value">${(lcp/1000).toFixed(2)}s</div>LCP <span class="status ${lcp<=2500?'good':'bad'}">${lcp<=2500?'Good':'Poor'}</span>
        <details><summary>What / Why / How?</summary>Largest content load time. Slow LCP feels laggy. Optimize hero images, preload critical CSS/JS.</details></div>
      <div class="metric"><div class="value">${Math.round(worstINP)}ms</div>INP <span class="status ${worstINP<=200?'good':'bad'}">${worstINP<=200?'Good':'Poor'}</span>
        <details><summary>What / Why / How?</summary>Responsiveness to taps. High INP = frustration. Break up JS, use web workers.</details></div>
      <div class="metric"><div class="value">${cls.toFixed(3)}</div>CLS <span class="status ${cls<=0.1?'good':'bad'}">${cls<=0.1?'Good':'Poor'}</span>
        <details><summary>What / Why / How?</summary>Layout jumps. Set width/height on images, reserve ad space.</details></div>
      <div class="metric"><div class="value">${fcp?(fcp/1000).toFixed(2)+'s':'N/A'}</div>FCP <span class="status ${fcp<=1800?'good':'bad'}">${fcp<=1800?'Good':'Poor'}</span></div>
      <div class="metric"><div class="value">${Math.round(ttfb)}ms</div>TTFB <span class="status ${ttfb<=600?'good':'bad'}">${ttfb<=600?'Good':'Poor'}</span></div>
    `;

    document.getElementById('results').style.display = 'block';
    document.getElementById('status').innerHTML = 'Live audit complete!';
  }, 4000);
}
</script>

</body>
</html>